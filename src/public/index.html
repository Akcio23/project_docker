<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>CRUD de Carros</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <div class="container">
        <h1>Cadastro de Carros</h1>

        <!-- Formulário para criar/editar carro -->
        <form id="car-form">
            <input type="text" id="name" placeholder="Nome do carro" required />
            <input type="text" id="brand" placeholder="Marca" required />
            <input type="number" id="year" placeholder="Ano" required />
            <button type="submit" id="submit-btn">Criar Carro</button>
            <button type="button" id="cancel-btn" style="display: none;">Cancelar Edição</button>
        </form>

        <h2>Lista de Carros</h2>
        <ul id="car-list"></ul>
    </div>

    <script>
        const form = document.getElementById('car-form');
        const carList = document.getElementById('car-list');
        const cancelBtn = document.getElementById('cancel-btn');
        const submitBtn = document.getElementById('submit-btn');

        let editingCar = null;

        // Função para buscar todos os carros
        async function fetchCars() {
            const res = await fetch('/cars');
            const cars = await res.json();
            carList.innerHTML = '';
            cars.forEach(car => {
                const li = document.createElement('li');
                li.innerHTML = `
                    ${car.id} - ${car.name} | ${car.brand} | ${car.year}
                    <button onclick="editCar(${car.id}, '${car.name}', '${car.brand}', ${car.year})">Editar</button>
                    <button onclick="deleteCar(${car.id})">Deletar</button>
                `;
                carList.appendChild(li);
            });
        }

        // Função para editar um carro
        function editCar(id, name, brand, year) {
            editingCar = { id, name, brand, year };
            document.getElementById('name').value = name;
            document.getElementById('brand').value = brand;
            document.getElementById('year').value = year;
            submitBtn.textContent = 'Atualizar Carro';
            cancelBtn.style.display = 'inline-block';  // Exibe o botão de cancelar
        }

        // Função para cancelar a edição
        cancelBtn.addEventListener('click', () => {
            editingCar = null;
            form.reset();
            submitBtn.textContent = 'Criar Carro';
            cancelBtn.style.display = 'none';  // Esconde o botão de cancelar
        });

        // Função para enviar os dados do formulário (criar ou atualizar)
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('name').value;
            const brand = document.getElementById('brand').value;
            const year = document.getElementById('year').value;

            if (editingCar) {
                // Atualizar o carro
                await fetch(`/cars/${editingCar.id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name, brand, year })
                });
                editingCar = null;
                cancelBtn.style.display = 'none';
            } else {
                // Criar um novo carro
                await fetch('/cars', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name, brand, year })
                });
            }

            form.reset();
            submitBtn.textContent = 'Criar Carro';
            fetchCars();  // Atualiza a lista de carros após criar ou editar
        });

        // Função para deletar um carro
        async function deleteCar(id) {
            await fetch(`/cars/${id}`, { method: 'DELETE' });
            fetchCars();  // Atualiza a lista de carros após deletar
        }

        // Inicializa a lista de carros quando a página for carregada
        fetchCars();
    </script>
</body>
</html>
